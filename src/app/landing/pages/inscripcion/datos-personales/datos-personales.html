<form #datosForm="ngForm" (ngSubmit)="submitDatos(datosForm)" novalidate>
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card p-4 shadow-sm mb-4" style="background-color: #f8f1e9;">

                <h3 class="mb-4 text-primary"><i class="bi bi-person-fill me-2"></i>1. Datos Personales</h3>

                <div *ngIf="successMessage" class="alert alert-success d-flex align-items-center mb-4" role="alert">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <div>
                        <strong>¡Éxito!</strong> {{ successMessage }}
                    </div>
                </div>

                <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center mb-4" role="alert">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <div>
                        <strong>Error:</strong> {{ errorMessage }}

                        <div *ngIf="errorMessage.includes('cuenta activa') || errorMessage.includes('inicia sesión')">
                            <small>Por favor, usa la opción de **Iniciar Sesión** para acceder a tu cuenta.</small>
                        </div>
                    </div>
                </div>

                <!-- Campo Nombre -->
                <div class="mb-3">
                    <label for="nombre" class="form-label">Nombre Completo <span class="text-danger">*</span></label>
                    <input 
                        type="text" 
                        class="form-control" 
                        [class.is-invalid]="nombreInvalid"
                        id="nombre" 
                        name="nombre" 
                        placeholder="Ej: Juan Pérez"
                        required 
                        [(ngModel)]="datos.nombre"
                        (blur)="validateNombre()"
                        (input)="nombreInvalid = false">
                    <div class="invalid-feedback" *ngIf="nombreInvalid">
                        {{ nombreErrorMsg }}
                    </div>
                    <small class="form-text text-muted">Ingresa tu nombre completo (mínimo 3 caracteres)</small>
                </div>

                <!-- Campo Email -->
                <div class="mb-3">
                    <label for="email" class="form-label">Correo Electrónico <span class="text-danger">*</span></label>
                    <input 
                        type="email" 
                        class="form-control" 
                        [class.is-invalid]="emailInvalid"
                        id="email" 
                        name="email" 
                        placeholder="ejemplo@correo.com"
                        required 
                        email 
                        [(ngModel)]="datos.email"
                        (blur)="validateEmail()"
                        (input)="emailInvalid = false"
                        (change)="clearError()">
                    <div class="invalid-feedback" *ngIf="emailInvalid">
                        {{ emailErrorMsg }}
                    </div>
                    <small class="form-text text-muted">Asegúrate de ingresar un correo válido</small>
                </div>

                <!-- Campo Teléfono -->
                <div class="mb-4">
                    <label for="telefono" class="form-label">Teléfono <span class="text-danger">*</span></label>
                    <input 
                        type="tel" 
                        class="form-control" 
                        [class.is-invalid]="telefonoInvalid"
                        id="telefono" 
                        name="telefono" 
                        placeholder="Ej: +51 921 340 064"
                        required 
                        [(ngModel)]="datos.telefono"
                        (blur)="validateTelefono()"
                        (input)="telefonoInvalid = false">
                    <div class="invalid-feedback" *ngIf="telefonoInvalid">
                        {{ telefonoErrorMsg }}
                    </div>
                    <small class="form-text text-muted">Ingresa un número válido (7-15 dígitos)</small>
                </div>

                <div class="d-grid mt-4">
                    <button 
                        type="submit" 
                        class="btn-formulario btn-lg"
                        [disabled]="datosForm.invalid || isLoading || errorMessage || nombreInvalid || emailInvalid || telefonoInvalid">
                        <span *ngIf="!isLoading">
                            Continuar a Selección de Talleres
                            <i class="bi bi-arrow-right-circle-fill ms-2"></i>
                        </span>
                        <span *ngIf="isLoading">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Guardando...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>