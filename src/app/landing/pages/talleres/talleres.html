<main class="container my-5">
    <h1 class="text-center mb-5">Nuestros Talleres y Cursos</h1>

    <div *ngIf="talleres.length === 0" class="alert alert-info text-center" role="alert">
        No hay talleres disponibles en este momento.
    </div>

    <div *ngFor="let taller of talleres; let i = index">

        <div class="card mb-50" [id]="'taller-' + taller.id">
            <div class="row g-0">

                <div class="col-md-4">
                    <img [src]="taller.imagenTaller" class="img-fluid rounded-start h-100"
                        [alt]="'Taller de ' + taller.nombre">
                </div>

                <div class="col-md-8">
                    <div class="card-body d-flex justify-content-between card-body-precio">
                        <div>
                            <h5 class="card-title fw-bold">Taller de {{ taller.nombre }}</h5>
                            <p class="card-text mb-2">{{ taller.descripcion }}</p>
                            
                            <p class="card-text text-muted">
                                Duración: <span>{{ taller.duracionSemanas }} semanas</span>
                                <br>
                                Clases: <span>{{ taller.clasesPorSemana }} veces por semana</span>
                            </p>

                            <div class="mt-3">
                                <p class="card-text">
                                    <b class="text-primary">Temas: </b>
                                    <span>{{ taller.temas || 'Temas no especificados.' }}</span>
                                </p>
                            </div>
                        </div>

                        <div class="align-self-end text-end">
                            <p class="precio-grande">{{ formatPrecio(taller.precio) }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card-footer bg-transparent border-top">
                <button class="btn btn-outline-primary w-100" type="button" data-bs-toggle="collapse"
                    [attr.data-bs-target]="'#horarios-ext-' + taller.id" 
                    aria-expanded="false" 
                    [attr.aria-controls]="'horarios-ext-' + taller.id">
                    Ver Horarios Disponibles <i class="bi bi-calendar-check"></i>
                </button>
            </div>
        </div>

        <div class="collapse bg-light p-3 border border-top-0 rounded-bottom mb-5" 
             [id]="'horarios-ext-' + taller.id">

            <div *ngIf="taller.horariosAbiertos && taller.horariosAbiertos.length > 0">
                <h6 class="text-success mb-3"><i class="bi bi-clock"></i> Grupos con cupos y próxima fecha de inicio:</h6>
                
                <div class="list-group">
                    <div *ngFor="let horario of taller.horariosAbiertos"
                        class="list-group-item list-group-item-action d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                        
                        <div>
                            <span class="fw-bold">{{ horario.diasDeClase }}</span>
                            <span> de {{ formatHora(horario.horaInicio) }} a {{ formatHora(horario.horaFin) }}</span>
                            <small class="text-muted d-block">Profesor: {{ horario.profesor.nombreCompleto }}</small>

                            <ng-container *ngIf="getDiasRestantes(horario.fechaInicio) <= 10; else fechaNormal">
                                <span class="badge bg-warning text-dark me-2">
                                    ¡Quedan sólo <span>{{ getDiasRestantes(horario.fechaInicio) }}</span> días para iniciar!
                                </span>
                            </ng-container>
                            <ng-template #fechaNormal>
                                <span class="badge bg-info">
                                    Inicia: <span>{{ formatFecha(horario.fechaInicio) }}</span>
                                </span>
                            </ng-template>
                        </div>
                        
                        <div class="text-end mt-2 mt-md-0">
                            <span class="badge bg-primary me-2">Vacantes: {{ horario.vacantesDisponibles }}</span>
                            <a [routerLink]="['/inscripcion']" 
                               [queryParams]="{ tallerId: taller.id, horarioId: horario.id }"
                               class="btn btn-sm btn-success mt-2 mt-md-0">Inscribirme</a>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="!taller.horariosAbiertos || (taller.horariosAbiertos.length === 0 && taller.tieneHorariosDefinidos)">
                <div class="alert alert-danger text-center mb-0">
                    <i class="bi bi-exclamation-triangle-fill"></i> ¡Atención! Todos los grupos de <span>{{ taller.nombre }}</span> ya han comenzado o no hay vacantes disponibles.
                    <p class="mt-2 mb-0">Comunícate con Soporte/Administración para consultar cuándo se abrirán nuevos horarios.</p>
                    <a [routerLink]="['/contacto']" class="btn btn-sm btn-outline-secondary mt-2">Contactar</a>
                </div>
            </div>

            <div *ngIf="!taller.tieneHorariosDefinidos">
                <div class="alert alert-info text-center mb-0">
                    <i class="bi bi-info-circle-fill"></i> Este taller actualmente no tiene horarios programados.
                    <p class="mt-2 mb-0">Contáctanos para **solicitar la apertura de un horario** para este curso.</p>
                    <a [routerLink]="['/contacto']" class="btn btn-sm btn-outline-secondary mt-2">Solicitar Horario</a>
                </div>
            </div>

        </div>
    </div>
</main>